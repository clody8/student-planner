# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ Docker Compose ContainerConfig

## üö® –ü—Ä–æ–±–ª–µ–º–∞

–û—à–∏–±–∫–∞ `KeyError: 'ContainerConfig'` –≤ Docker Compose 1.29.2 –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–∑-–∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –≤–µ—Ä—Å–∏–π.

```
ERROR: for backlog_postgres  'ContainerConfig'
KeyError: 'ContainerConfig'
```

## üõ†Ô∏è –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
./scripts/fix-docker.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –û—Å—Ç–∞–Ω–æ–≤–∏—Ç –∏ —É–¥–∞–ª–∏—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –û—á–∏—Å—Ç–∏—Ç Docker —Å–∏—Å—Ç–µ–º—É
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –ó–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å—ã –ø–æ—à–∞–≥–æ–≤–æ

### –†–µ—à–µ–Ω–∏–µ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Docker Compose

```bash
# –û–±–Ω–æ–≤–∏—Ç–µ Docker Compose –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
./scripts/update-docker-compose.sh
```

### –†–µ—à–µ–Ω–∏–µ 3: –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

#### –®–∞–≥ 1: –û—á–∏—Å—Ç–∫–∞
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down --remove-orphans

# –£–¥–∞–ª–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker stop backlog_postgres backlog_backend backlog_frontend backlog_nginx backlog_certbot
docker rm backlog_postgres backlog_backend backlog_frontend backlog_nginx backlog_certbot

# –û—á–∏—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É
docker system prune -f
docker volume prune -f
```

#### –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
cp docker-compose.yml docker-compose.yml.backup

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
cp docker-compose.fixed.yml docker-compose.yml
```

#### –®–∞–≥ 3: –ü–æ—à–∞–≥–æ–≤—ã–π –∑–∞–ø—É—Å–∫
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã –ø–æ –æ–¥–Ω–æ–º—É
docker-compose up -d postgres
sleep 15

docker-compose up -d backend
sleep 10

docker-compose up -d frontend
sleep 10

docker-compose up -d nginx certbot
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ Docker Compose
```bash
docker-compose --version
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```bash
docker-compose ps
docker ps -a
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
docker-compose logs postgres
docker-compose logs backend
```

## üìã –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ –≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏

1. **–ù–æ–≤—ã–µ –∏–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤** - –∏–∑–±–µ–≥–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
2. **–ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ volumes** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–±–ª–µ–º—ã —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
3. **–Ø–≤–Ω—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã** - —á–µ—Ç–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ volumes
4. **–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** - —É–±—Ä–∞–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
curl -I http://unl-backlog.duckdns.org:8080
curl -I https://unl-backlog.duckdns.org:8443

# –õ–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
docker-compose logs --tail=50
```

## üÜò –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è

1. **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Docker daemon**:
   ```bash
   sudo systemctl restart docker
   ```

2. **–ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ Docker**:
   ```bash
   docker system prune -a --volumes
   ```

3. **–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Compose**:
   ```bash
   sudo apt remove docker-compose
   sudo apt install docker-compose-plugin
   ```

4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Compose V2**:
   ```bash
   # –í–º–µ—Å—Ç–æ docker-compose –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ
   docker compose up -d
   ```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–æ –∏–∑ —Ä–µ—à–µ–Ω–∏–π –Ω–µ –ø–æ–º–æ–≥–ª–æ:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏–∏ Docker –∏ Docker Compose
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ Docker socket
4. –°–æ–∑–¥–∞–π—Ç–µ issue —Å –ø–æ–ª–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏ –æ—à–∏–±–∫–∏ 